<!DOCTYPE HTML>
<html>
  
<head>
  <!-- Encoding -->
  <meta charset="UTF-8">
  <link rel="icon" href="/favicon.ico">
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Joseph Curtin - Machine Learning, Infrastructure, & Cloud" />
  <meta name="keywords" content="Machine Learning, Infrastructure, & Cloud" />
  <meta name="author" content="Joseph Curtin's Website" />
  <title>
    Compression Benchmarks for PostgreSQL Archives
    </title>
  <!-- Imports -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css"
    integrity="sha256-nQ6wLtrBdTlYGKygEWcUZItTqIGXhUmg2m34X4ZPXaQ="
    crossorigin="anonymous"/>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer" />
  <!-- <link rel="stylesheet" href="/main.css" crossorigin="anonymous" /> -->
  <link rel="stylesheet" href="https://wi-th-voice.com/main.css">
</head>

  <body>
    <section class="columns">
      <div class="column is-3">
        
<div class="has-text-right page-title-column">
  <a href="/">
    <h1 class="page-title title is-2 has-text-primary"> We Are WIθ!!! </h1>
    <p class="subtitle is-6 vert-spacing"> 児童合唱団WIθ </p>
  </a>
  <!-- <hr class="title-divider" /> -->
  <section class="vert-spacing">
    <div class="equal-height">
      <div class="card-content is-flex" style="justify-content: center;">
        <figure class="image is-64x64 is-center">
          <img src="/images/line-contact-grey.png" alt="Brain" />
        </figure>
      </div>
    </div>
  </section>
  <section class="section" style="padding: 0;">
    <ul class="buttons">
      <li>
  <div id="subscribe-field" class="field has-addons">
    <div class="control has-icons-left has-icons-right">
      <input class="input" name="subscribe-email" type="email" placeholder="your@email.here to subscribe" />
      <span class="icon is-small is-left">
        <i class="fa-regular fa-newspaper"></i>
      </span>
      <span class="icon is-small is-right">
        <i class="fas fa-check"></i>
      </span>
    </div>
    <div id="subscribe-button" class="control">
      <button class="button">
        Subscribe
      </button>
    </div>
    <p class="note help is-danger" style="text-align: left;"> Invalid Email </p>
  </div>
</li>

      <li>
        <a href="mailto:42@jbcurtin.io" target="_blank" class="button">
          <span> Connect over Email </span>
          <span class="icon is-medium">
            <i class="fa-regular fa-envelope"></i>
          </span>
        </a>
      </li>
      <li>
        <a href="/articles&#x2F;postgresql-compression-benchmark&#x2F;" class="button">
        <span>
            English&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <i class="fa-solid fa-language"></i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            日本語
          </span>
        </a>
      </li>
    </ul>
  </section>
</div>

        <div class="container">
          <aside class="menu hide-on-mobile">
            
<p class="menu-label">Search</p>
<ul class="menu-list">
  <li>
    <div class="field">
      <div class="control has-icons-left has-icons-right">
        <input id="aside-search-input" class="input" type="text" placeholder="Search Articles" value="">
        <span class="icon is-small is-left">
          <i class="fa-solid fa-magnifying-glass"></i>
        </span>
        <span class="icon is-small is-right">
          <i class="fas fa-close"></i>
        </span>
      </div>
    </div>
  </li>
</ul>

            
<p class="menu-label">Article Filters</p>
<ul class="menu-list">


  <li>
    <a href="&#x2F;articles&#x2F;">Performance Analysis</a>
  </li>

</ul>

          </aside>
        </div>
      </div>
      <div class="column is-9">
        <article class="content">
          <header class="main-top">
            <h1 class="page-title title is-2 has-text-primary"> Compression Benchmarks for PostgreSQL Archives </h1>
            <p class="subtitle is-6">
              <time datetime="2024-08-29"> August 29, 2024 </time>
            </p>
          </header>
          <section class="content">
            <p>
              <p>By far, my favorite RDBMS is PostgreSQL. Having worked with MySQL, MSSQL, Cassandra, Redis and more; the versatility of PostgreSQL continues to inspire me to write better and more complex SQL. I have a piece of software that reaches out to various news websites following best practices for crawling. Scraping content using provided by the <code>sitemap.xml</code> and following the rules set forth by the robots.txt file. The content of these sites can be anything, but the general approach is to collect as much news as possible to see if I can develop a series of heuristics to provide as technical indicators.</p>
<p>I've been running the software for about two years now, and a massive PostgreSQL table has been created from the result of it. Today, I'd like to start making regular backups of the data in the table. This article will focus on benchmarking how long it'll take to backup a table using the <code>pg_dump</code> program &amp; <a rel="noopener" target="_blank" href="https://www.docker.com/">Docker</a>.</p>
<p>Standing on the shoulders of giants, I've found a <a rel="noopener" target="_blank" href="https://linuxreviews.org/Comparison_of_Compression_Algorithms">comprehensive review of algorithms</a> used for compression. I'm not concerned with parallel processing; I'll stick to evaluating the programs as provided. What I'm looking to glean is a definitive and consistent measurement of how long it'll take to export and compress information for the massive PostgreSQL table.</p>
<h2 id="benchmark-setup">Benchmark Setup</h2>
<p>Benchmark setup is fairly straightforward. A table called <code>location</code> tracks various metrics about URLs such as <code>crawl_delay</code>, <code>domain</code> of the URL, <code>change_ferq</code>, and <code>lastmod</code>. Properties provided by a sites' <code>sitemap.xml</code>. Which in turn allows for the development of an algorithm to select more relevant pages, yet still allow the crawler to search for archived content while not overburdening the website. The <code>location</code> table will be used to identify the best compression algorithm benchmark for the much larger table</p>
<pre data-lang="bash" style="background-color:#191919;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#e9fdac;">timestamp_start</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span style="color:#e9fdac;">date</span><span style="font-style:italic;color:#fc9354;"> -d </span><span style="color:#ffffff;">&quot;$</span><span style="color:#e9fdac;">timestamp</span><span style="color:#ffffff;">&quot;</span><span> +</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">%s</span><span style="color:#ffffff;">&quot;
</span><span style="color:#e9fdac;">docker</span><span> exec </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">container_id</span><span> /usr/local/bin/pg_dump</span><span style="font-style:italic;color:#fc9354;"> -h</span><span> localhost</span><span style="font-style:italic;color:#fc9354;"> -U</span><span> dbuser</span><span style="font-style:italic;color:#fc9354;"> -t</span><span> location</span><span style="font-style:italic;color:#fc9354;"> -a -d</span><span> dbname </span><span style="color:#ff5e5e;">&gt; </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">host_filepath
</span><span style="color:#e9fdac;">timestamp_start</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span></code></pre>
<p>The database is ran using docker, specifically the <code>postgis:15-3.3-alpine</code> image. Port <code>5432</code> is exposed to the host, but we won't use it because it seems that connecting to a port exposed to the host will route traffic through the LAN. Instead we'll export data in the container and compress the output from the <code>exec</code> command to a <code>filepath</code> on the host.</p>
<p>How the database has been initalized using Docker</p>
<pre data-lang="bash" style="background-color:#191919;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#e9fdac;">docker</span><span> run</span><span style="font-style:italic;color:#fc9354;"> -p </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">5432:5432</span><span style="color:#ffffff;">&quot;</span><span style="font-style:italic;color:#fc9354;"> --name</span><span> postgresql-datastore</span><span style="font-style:italic;color:#fc9354;"> -e </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">POSTGRES_USER=dbuser</span><span style="color:#ffffff;">&#39;</span><span style="font-style:italic;color:#fc9354;"> -e </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">POSTGRES_PASSWORD=password</span><span style="color:#ffffff;">&#39;</span><span style="font-style:italic;color:#fc9354;"> -e </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">POSTGRES_DB=dbname</span><span style="color:#ffffff;">&#39;</span><span style="font-style:italic;color:#fc9354;"> -d --shm-size</span><span style="color:#ff5e5e;">=</span><span>12g postgis:15-3.3-alpine
</span></code></pre>
<p>The compression algorithms to be tested are <a rel="noopener" target="_blank" href="https://github.com/facebook/zstd">zstd</a>, <a rel="noopener" target="_blank" href="https://www.gzip.org/">gzip</a>, <a rel="noopener" target="_blank" href="https://gitlab.com/bzip2/bzip2/">bzip2</a>, <a rel="noopener" target="_blank" href="https://github.com/lz4/lz4">lz4</a>, and <a rel="noopener" target="_blank" href="https://github.com/tukaani-project/xz">xz</a>.</p>
<p>Here is the full script to run the benchmark</p>
<pre data-lang="bash" style="background-color:#191919;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#6d6d6d;">#!/usr/bin/env bash
</span><span>
</span><span style="color:#6699cc;">set </span><span style="font-style:italic;color:#fc9354;">-e
</span><span>
</span><span style="color:#e9fdac;">TABLES</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">location</span><span style="color:#ffffff;">&quot;
</span><span>
</span><span style="color:#e9fdac;">timestamp</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span style="color:#e9fdac;">dump_dir</span><span style="color:#ff5e5e;">=</span><span style="color:#fbe3bf;">/datatore/backups
</span><span>
</span><span style="color:#ff5e5e;">for</span><span> table </span><span style="color:#ff5e5e;">in </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">TABLES</span><span style="color:#ff5e5e;">; do
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">ZSTD Benchmark</span><span style="color:#ffffff;">&quot;
</span><span>  </span><span style="color:#e9fdac;">filepath</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">dump_dir</span><span style="color:#fbe3bf;">/</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">.</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp</span><span style="color:#fbe3bf;">.sql-data.zstd
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">Dumping table &#39;</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">&#39; to </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath</span><span style="color:#ffffff;">&quot;
</span><span>  </span><span style="color:#e9fdac;">container_id</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">docker</span><span style="color:#fbe3bf;"> ps</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">grep</span><span style="color:#fbe3bf;"> datastore</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">awk </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">{print $1}</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_start</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_start_interval</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date</span><span style="font-style:italic;color:#fc9354;"> -d </span><span style="color:#ffffff;">&quot;$</span><span style="color:#e9fdac;">timestamp_start</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;"> +</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">%s</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">docker</span><span> exec </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">container_id</span><span> /usr/local/bin/pg_dump</span><span style="font-style:italic;color:#fc9354;"> -h</span><span> localhost</span><span style="font-style:italic;color:#fc9354;"> -U</span><span> dbuser</span><span style="font-style:italic;color:#fc9354;"> -t </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="font-style:italic;color:#fc9354;"> -a -d</span><span> dbname </span><span style="color:#ff5e5e;">| </span><span>\
</span><span>    </span><span style="color:#e9fdac;">zstd</span><span style="font-style:italic;color:#fc9354;"> -T2 </span><span style="color:#ff5e5e;">&gt; </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath
</span><span>  </span><span style="color:#e9fdac;">timestamp_stop</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_stop_interval</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date</span><span style="font-style:italic;color:#fc9354;"> -d </span><span style="color:#ffffff;">&quot;$</span><span style="color:#e9fdac;">timestamp_stop</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;"> +</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">%s</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_diff</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">((</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_stop_interval </span><span style="color:#ff5e5e;">- </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_start_interval</span><span style="color:#fbe3bf;">))
</span><span>  </span><span style="color:#e9fdac;">filesize</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">du</span><span style="font-style:italic;color:#fc9354;"> -sh </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">awk </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">{print $1}</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">Benchmark for Table: </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">, Compression: ztsd. Filesize: </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filesize</span><span style="color:#fbe3bf;">. Took </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_diff</span><span style="color:#fbe3bf;"> seconds</span><span style="color:#ffffff;">&quot;
</span><span>
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">GZIP Benchmark</span><span style="color:#ffffff;">&quot;
</span><span>  </span><span style="color:#e9fdac;">filepath</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">dump_dir</span><span style="color:#fbe3bf;">/</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">.</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp</span><span style="color:#fbe3bf;">.sql-data.gzip
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">Dumping table &#39;</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">&#39; to </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath</span><span style="color:#ffffff;">&quot;
</span><span>  </span><span style="color:#e9fdac;">container_id</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">docker</span><span style="color:#fbe3bf;"> ps</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">grep</span><span style="color:#fbe3bf;"> datastore</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">awk </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">{print $1}</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_start</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_start_interval</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date</span><span style="font-style:italic;color:#fc9354;"> -d </span><span style="color:#ffffff;">&quot;$</span><span style="color:#e9fdac;">timestamp_start</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;"> +</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">%s</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">docker</span><span> exec </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">container_id</span><span> /usr/local/bin/pg_dump</span><span style="font-style:italic;color:#fc9354;"> -h</span><span> localhost</span><span style="font-style:italic;color:#fc9354;"> -U</span><span> dbuser</span><span style="font-style:italic;color:#fc9354;"> -t </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="font-style:italic;color:#fc9354;"> -a -d</span><span> dbname </span><span style="color:#ff5e5e;">| </span><span>\
</span><span>    </span><span style="color:#e9fdac;">gzip</span><span style="font-style:italic;color:#fc9354;"> -c </span><span style="color:#ff5e5e;">&gt; </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath
</span><span>  </span><span style="color:#e9fdac;">timestamp_stop</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_stop_interval</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date</span><span style="font-style:italic;color:#fc9354;"> -d </span><span style="color:#ffffff;">&quot;$</span><span style="color:#e9fdac;">timestamp_stop</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;"> +</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">%s</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_diff</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">((</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_stop_interval </span><span style="color:#ff5e5e;">- </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_start_interval</span><span style="color:#fbe3bf;">))
</span><span>  </span><span style="color:#e9fdac;">filesize</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">du</span><span style="font-style:italic;color:#fc9354;"> -sh </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">awk </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">{print $1}</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">Benchmark for Table: </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">, Compression: gzip. Filesize: </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filesize</span><span style="color:#fbe3bf;">, Took </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_diff</span><span style="color:#fbe3bf;"> seconds</span><span style="color:#ffffff;">&quot;
</span><span>
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">bzip2 Benchmark</span><span style="color:#ffffff;">&quot;
</span><span>  </span><span style="color:#e9fdac;">filepath</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">dump_dir</span><span style="color:#fbe3bf;">/</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">.</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp</span><span style="color:#fbe3bf;">.sql-data.bzip2
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">Dumping table &#39;</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">&#39; to </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath</span><span style="color:#ffffff;">&quot;
</span><span>  </span><span style="color:#e9fdac;">container_id</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">docker</span><span style="color:#fbe3bf;"> ps</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">grep</span><span style="color:#fbe3bf;"> datastore</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">awk </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">{print $1}</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_start</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_start_interval</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date</span><span style="font-style:italic;color:#fc9354;"> -d </span><span style="color:#ffffff;">&quot;$</span><span style="color:#e9fdac;">timestamp_start</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;"> +</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">%s</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">docker</span><span> exec </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">container_id</span><span> /usr/local/bin/pg_dump</span><span style="font-style:italic;color:#fc9354;"> -h</span><span> localhost</span><span style="font-style:italic;color:#fc9354;"> -U</span><span> dbuser</span><span style="font-style:italic;color:#fc9354;"> -t </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="font-style:italic;color:#fc9354;"> -a -d</span><span> dbname </span><span style="color:#ff5e5e;">| </span><span>\
</span><span>    </span><span style="color:#e9fdac;">bzip2</span><span style="font-style:italic;color:#fc9354;"> -cz </span><span style="color:#ff5e5e;">&gt; </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath
</span><span>  </span><span style="color:#e9fdac;">timestamp_stop</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_stop_interval</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date</span><span style="font-style:italic;color:#fc9354;"> -d </span><span style="color:#ffffff;">&quot;$</span><span style="color:#e9fdac;">timestamp_stop</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;"> +</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">%s</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_diff</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">((</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_stop_interval </span><span style="color:#ff5e5e;">- </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_start_interval</span><span style="color:#fbe3bf;">))
</span><span>  </span><span style="color:#e9fdac;">filesize</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">du</span><span style="font-style:italic;color:#fc9354;"> -sh </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">awk </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">{print $1}</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">Benchmark for Table: </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">, Compression: bzip2. Filesize: </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filesize</span><span style="color:#fbe3bf;">. Took </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_diff</span><span style="color:#fbe3bf;"> seconds</span><span style="color:#ffffff;">&quot;
</span><span>
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">lz4 Benchmark</span><span style="color:#ffffff;">&quot;
</span><span>  </span><span style="color:#e9fdac;">filepath</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">dump_dir</span><span style="color:#fbe3bf;">/</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">.</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp</span><span style="color:#fbe3bf;">.sql-data.lz4
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">Dumping table &#39;</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">&#39; to </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath</span><span style="color:#ffffff;">&quot;
</span><span>  </span><span style="color:#e9fdac;">container_id</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">docker</span><span style="color:#fbe3bf;"> ps</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">grep</span><span style="color:#fbe3bf;"> datastore</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">awk </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">{print $1}</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_start</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_start_interval</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date</span><span style="font-style:italic;color:#fc9354;"> -d </span><span style="color:#ffffff;">&quot;$</span><span style="color:#e9fdac;">timestamp_start</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;"> +</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">%s</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">docker</span><span> exec </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">container_id</span><span> /usr/local/bin/pg_dump</span><span style="font-style:italic;color:#fc9354;"> -h</span><span> localhost</span><span style="font-style:italic;color:#fc9354;"> -U</span><span> dbuser</span><span style="font-style:italic;color:#fc9354;"> -t </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="font-style:italic;color:#fc9354;"> -a -d</span><span> dbname </span><span style="color:#ff5e5e;">| </span><span>\
</span><span>    </span><span style="color:#e9fdac;">lz4 </span><span style="color:#ff5e5e;">&gt; </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath
</span><span>  </span><span style="color:#e9fdac;">timestamp_stop</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_stop_interval</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date</span><span style="font-style:italic;color:#fc9354;"> -d </span><span style="color:#ffffff;">&quot;$</span><span style="color:#e9fdac;">timestamp_stop</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;"> +</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">%s</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_diff</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">((</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_stop_interval </span><span style="color:#ff5e5e;">- </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_start_interval</span><span style="color:#fbe3bf;">))
</span><span>  </span><span style="color:#e9fdac;">filesize</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">du</span><span style="font-style:italic;color:#fc9354;"> -sh </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">awk </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">{print $1}</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">Benchmark for Table: </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">, Compression: lz4. Filesize: </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filesize</span><span style="color:#fbe3bf;">. Took </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_diff</span><span style="color:#fbe3bf;"> seconds</span><span style="color:#ffffff;">&quot;
</span><span>
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">xz Benchmark</span><span style="color:#ffffff;">&quot;
</span><span>  </span><span style="color:#e9fdac;">filepath</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">dump_dir</span><span style="color:#fbe3bf;">/</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">.</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp</span><span style="color:#fbe3bf;">.sql-data.xz
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">Dumping table &#39;</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">&#39; to </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath</span><span style="color:#ffffff;">&quot;
</span><span>  </span><span style="color:#e9fdac;">container_id</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">docker</span><span style="color:#fbe3bf;"> ps</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">grep</span><span style="color:#fbe3bf;"> datastore</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">awk </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">{print $1}</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_start</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_start_interval</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date</span><span style="font-style:italic;color:#fc9354;"> -d </span><span style="color:#ffffff;">&quot;$</span><span style="color:#e9fdac;">timestamp_start</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;"> +</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">%s</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">docker</span><span> exec </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">container_id</span><span> /usr/local/bin/pg_dump</span><span style="font-style:italic;color:#fc9354;"> -h</span><span> localhost</span><span style="font-style:italic;color:#fc9354;"> -U</span><span> dbuser</span><span style="font-style:italic;color:#fc9354;"> -t </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="font-style:italic;color:#fc9354;"> -a -d</span><span> dbname </span><span style="color:#ff5e5e;">| </span><span>\
</span><span>    </span><span style="color:#e9fdac;">xz</span><span style="font-style:italic;color:#fc9354;"> -cz </span><span style="color:#ff5e5e;">&gt; </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath
</span><span>  </span><span style="color:#e9fdac;">timestamp_stop</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">+%Y-%m-%dT%H:%M:%S</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_stop_interval</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">date</span><span style="font-style:italic;color:#fc9354;"> -d </span><span style="color:#ffffff;">&quot;$</span><span style="color:#e9fdac;">timestamp_stop</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;"> +</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">%s</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#e9fdac;">timestamp_diff</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">((</span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_stop_interval </span><span style="color:#ff5e5e;">- </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_start_interval</span><span style="color:#fbe3bf;">))
</span><span>  </span><span style="color:#e9fdac;">filesize</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">$</span><span style="color:#fbe3bf;">(</span><span style="color:#e9fdac;">du</span><span style="font-style:italic;color:#fc9354;"> -sh </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filepath</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">awk </span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">{print $1}</span><span style="color:#ffffff;">&#39;</span><span style="color:#fbe3bf;">)
</span><span>  </span><span style="color:#6699cc;">echo </span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">Benchmark for Table: </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">table</span><span style="color:#fbe3bf;">, Compression: xz. Filesize: </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">filesize</span><span style="color:#fbe3bf;">. Took </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">timestamp_diff</span><span style="color:#fbe3bf;"> seconds</span><span style="color:#ffffff;">&quot;
</span><span style="color:#ff5e5e;">done
</span></code></pre>
<h2 id="benchmark-results">Benchmark Results</h2>
<pre data-lang="bash" style="background-color:#191919;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#e9fdac;">Benchmark</span><span> for Table: location, Compression: ztsd. Filesize: 1.6G. Took 88 seconds
</span><span style="color:#e9fdac;">Benchmark</span><span> for Table: location, Compression: gzip. Filesize: 1.7G, Took 200 seconds
</span><span style="color:#e9fdac;">Benchmark</span><span> for Table: location, Compression: bzip2. Filesize: 1.3G. Took 1144 seconds
</span><span style="color:#e9fdac;">Benchmark</span><span> for Table: location, Compression: lz4. Filesize: 2.5G. Took 88 seconds
</span><span style="color:#e9fdac;">Benchmark</span><span> for Table: location, Compression: xz. Filesize: 1.3G. Took 2662 seconds
</span></code></pre>
<p>A core trade off when selecting an optimal compression algorithm is the amount of time taken; relative to the ratio of the file before compression size over after compression size.</p>
<p>$$ Compression Ratio = {Uncompressed Size\over{Compressed Size}} $$</p>
<h3 id="understanding-the-benchmark-results">Understanding the Benchmark Results</h3>
<p>I'm more interested in the backup running quickly and am willing to accept slightly larger archived files. <code>bzip2</code> and <code>xz</code> both provided the smallest filesize, but the time to archive took well over twenty minutes for each. <code>ztsd</code> took about a minute and a half, and provided a slightly larger file at <code>1.6GB</code> in size</p>
<h4 id="data-stream">Data Stream</h4>
<p>I'm not archiving files. I'm archiving a stream coming from a <code>docker exec</code> command and that has additional overhead to consider. Rather than understanding the overhead, lets produce a metric for how many MB/s of information is being transmitted from the <code>docker exec</code> command. How much data is being piped into the various compression algorithms?</p>
<p>Exporting the same stream to <code>dd</code> for about a minute will tell us enough about how much data is being sent to the various compression algorithms</p>
<pre data-lang="bash" style="background-color:#191919;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#e9fdac;">docker</span><span> exec </span><span style="color:#ffffff;">$</span><span style="color:#e9fdac;">container_id</span><span> /usr/local/bin/pg_dump</span><span style="font-style:italic;color:#fc9354;"> -h</span><span> localhost</span><span style="font-style:italic;color:#fc9354;"> -U</span><span> dbuser</span><span style="font-style:italic;color:#fc9354;"> -t</span><span> location</span><span style="font-style:italic;color:#fc9354;"> -a -d</span><span> dbname</span><span style="color:#ff5e5e;">|</span><span style="color:#e9fdac;">dd </span><span style="color:#ff5e5e;">&gt;</span><span> /dev/null
</span><span style="color:#e9fdac;">5936424960</span><span> bytes (5.9 GB, 5.5 GiB) </span><span style="color:#e9fdac;">copied,</span><span> 60.3537 s, 98.4 MB/s
</span></code></pre>
<p>Knowing an average of <code>98.4 MB/s</code> is being transmitted, we now have enough information to estimate the compression ratio of each archive.</p>
<p>$$ Seconds \times \text{Average MB/s} \over {Compressed Size} $$</p>
<table><thead><tr><th>Algorithm</th><th>Math</th><th>Ratio</th></tr></thead><tbody>
<tr><td>zstd</td><td>$$ 88 \times 98.4 \over {1.6} $$</td><td>5412.0</td></tr>
<tr><td>gzip</td><td>$$ 200 \times 200 \over {1.7} $$</td><td>11576.471</td></tr>
<tr><td>bzip2</td><td>$$ 1144 \times 98.4 \over {1.3} $$</td><td>86592.0</td></tr>
<tr><td>lz4</td><td>$$ 88 \times 98.4 \over {2.5} $$</td><td>3463.680</td></tr>
<tr><td>xz</td><td>$$ 2262 \times 98.4 \over {1.3} $$</td><td>201492.923</td></tr>
</tbody></table>
<p>Compression Ratios can vary based on a multitude of factors, most notably is the amount of repeated information in the file being archived. For instance, text data often repeats while random data does not. Therefore we'll be able to achieve higher compression ratios on archives with text data (such as a PostgreSQL dump).</p>
<h2 id="article-references">Article References</h2>
<ul>
<li><a rel="noopener" target="_blank" href="https://www.rootusers.com/gzip-vs-bzip2-vs-xz-performance-comparison/">https://www.rootusers.com/gzip-vs-bzip2-vs-xz-performance-comparison/</a></li>
<li><a rel="noopener" target="_blank" href="https://linuxreviews.org/Comparison_of_Compression_Algorithms">https://linuxreviews.org/Comparison_of_Compression_Algorithms</a></li>
<li><a rel="noopener" target="_blank" href="https://en.wikipedia.org/wiki/Data_compression_ratio#Definition">https://en.wikipedia.org/wiki/Data_compression_ratio#Definition</a></li>
</ul>

            </p>
          </section>
        </article>
        <div class="column is-12 show-on-mobile">
          <aside class="menu">
            
<p class="menu-label">Search</p>
<ul class="menu-list">
  <li>
    <div class="field">
      <div class="control has-icons-left has-icons-right">
        <input id="aside-search-input" class="input" type="text" placeholder="Search Articles" value="">
        <span class="icon is-small is-left">
          <i class="fa-solid fa-magnifying-glass"></i>
        </span>
        <span class="icon is-small is-right">
          <i class="fas fa-close"></i>
        </span>
      </div>
    </div>
  </li>
</ul>

            
<p class="menu-label">Article Filters</p>
<ul class="menu-list">


  <li>
    <a href="&#x2F;articles&#x2F;">Performance Analysis</a>
  </li>

</ul>

          </aside>
        </div>
      </div>
    </section>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VZP9H4GE0Y"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-VZP9H4GE0Y');
</script>
<script type="text/javascript" src="https://wi-th-voice.com/elasticlunr.min.js" defer></script>
<script type="text/javascript" src="https://wi-th-voice.com/search_index.en.js" defer></script>
<script type="text/javascript" src="https://wi-th-voice.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://wi-th-voice.com/js.cookie-3.0.5.min.js" integrity="sha256-WCzAhd2P6gRJF9Hv3oOOd+hFJi/QJbv+Azn4CGB8gfY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://wi-th-voice.com/MathJax-3.2.2.js" defer></script>
<script type="text/javascript" src="https://wi-th-voice.com/main.js" defer></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script>

    <script type="text/javascript">
/// Debounce
function debounce(func, wait) {
  var timeout;
  return function () {
    var context = this;
    var args = arguments;
    clearTimeout(timeout);
    timeout = setTimeout(function () {
      timeout = null;
      func.apply(context, args);
    }, wait);
  };
}
function initAsideSearch() {
  const $aside_search_input = document.getElementById('aside-search-input');
  if($aside_search_input === null) {
    return;
  }
  $aside_search_input.addEventListener("keyup", debounce(async function($event) {
    if ($event.keyCode === 13 || $event.keyCode === 32) {
      var term = $aside_search_input.value.trim();
      if ($event.keyCode === 32) {
        term = term + " ";
      }
      const url_parts = [window.location.protocol, '//', window.location.host];
      if ("ja" != "en") {
        url_parts.push('/ja');
      }
      url_parts.push('/search/')
      const search_url = new URL(url_parts.join(''));
      search_url.searchParams.set('q', term);
      window.location.href = search_url;
    }
  }, 150));
}
if (document.readyState === "complete" || (document.readyState !== "loading" && !document.documentElement.doScroll)) {
  initAsideSearch();
} else {
  document.addEventListener("DOMContentLoaded", initAsideSearch);
} 
</script>

    <script type="text/javascript">
  $.fn.SubscribeField = function() {
    const COOKIE_NAME = 'subscribe-email';
    const elm = $(this);
    const regBttnElm = $("#subscribe-button");
    const noteElm = elm.find(".note");
    noteElm.hide();
    const setInvalid = function() {
      const newspaper_container = elm.find('.fa-newspaper').parent();
      newspaper_container.addClass('has-text-danger');
      // Right Icon
      const right_icon_container = elm.find('.icon.is-right');
      right_icon_container.addClass('has-text-danger');
      const right_icon = right_icon_container.find('i.fa-check');
      right_icon.removeClass('fa-check');
      right_icon.addClass('fa-close');
    }
    const setValid = function() {
      const newspaper_container = elm.find('.fa-newspaper').parent();
      newspaper_container.removeClass('has-text-danger');
      // Right Icon
      const right_icon_container = elm.find('.icon.is-right');
      right_icon_container.removeClass('has-text-danger');
      const right_icon = right_icon_container.find('i.fa-close');
      right_icon.removeClass('fa-close');
      right_icon.addClass('fa-check');
    }
    const setConfirmState = function(email) {
      const msg = `is been subscribed`;
      regBttnElm.find('button').text('Subscribed');
      regBttnElm.find('button').attr('disabled', 'disabled');
      elm.find('input[name=subscribe-email]').attr('disabled', 'disabled');
      elm.find('input[name=subscribe-email]').val(email);
      elm.find('.fa-newspaper').addClass('has-text-info');
      elm.find('.fa-check').parent().hide();
      // elm.find('.fa-check').parent().html('<span> Saved </span>');
      Cookies.set(COOKIE_NAME, email, { expires: 365, domain: window.location.hostname, SameSite: 'Strict', Secure: true });
    }
    const validateEmail = (email) => {
      return email.match(
        /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
      );
    }
    const handleKeyEvent = function($event) {
      const email = elm.find('input[name=subscribe-email]').val();
      if (validateEmail(email) == null) {
        setInvalid();
      } else {
        setValid();
        if ($event.originalEvent.keyCode == 13) {
          submitEmail();
        }
      }
    }
    // Handle Submission to Backend - ajax
    const submitEmail = function() {
      const email = elm.find('input[name=subscribe-email]').val();
      if (validateEmail(email) == null) {
        setInvalid();
        return;
      }
      const buildUrl = function (path) {
        if (window.location.hostname == 'localhost') {
          return `http://localhost:8200${path}`;
        } else if (window.location.hostname == 'jbcurtin.io') {
          return `https://newsletter.mlops-and-cloud-db.com${path}`;
        } else {
          console.error("Unable to build path");
        }
      }
      const handleSubmission = function(data) {
        setConfirmState(email);
      }
      const handleSubmissionError = function($event) {
        if ($event.responseText == "Success") {
          handleSubmission($event);
          return;
        }
        setInvalid();
      }
      $.ajax({
        type: 'POST',
        url: buildUrl('/nl/register'),
        data: `{ "email": "${email}" }`,
        success: handleSubmission,
        error: handleSubmissionError,
        contentType: "application/json",
        dataType: "json"
      });
    }
    // Attach Events
    setValid();
    // Detect Cookies
    if (Cookies.get(COOKIE_NAME) != undefined) {
      const email = Cookies.get(COOKIE_NAME);
      setConfirmState(email);
    } else {
      elm.find('input[name=subscribe-email]').on('keyup', handleKeyEvent);
      regBttnElm.on('click', function($event) {
        submitEmail();
        $event.preventDefault();
      });
    }
  }
  $(document).ready(() => {
    console.log('activate')
    $("#subscribe-field").SubscribeField();
  })
</script>

  </body>
</html>